# ğŸ“Š æ•°æ®æ¦‚è§ˆæ¥å£æ–‡æ¡£

## æ¥å£æ¦‚è¿°

æ•°æ®æ¦‚è§ˆæ¥å£æä¾›ç³»ç»Ÿæ ¸å¿ƒç”¨æˆ·ç»Ÿè®¡æ•°æ®ï¼Œä¸“æ³¨äºç”¨æˆ·ç›¸å…³çš„å…³é”®æŒ‡æ ‡ï¼Œå¸®åŠ©ç®¡ç†å‘˜å¿«é€Ÿäº†è§£å¹³å°çš„ç”¨æˆ·æ´»è·ƒæƒ…å†µå’Œä½¿ç”¨çŠ¶å†µã€‚

---

## ğŸ”— æ¥å£ä¿¡æ¯

- **æ¥å£åœ°å€**: `GET /api/v1/admin/dashboard/stats`
- **æƒé™è¦æ±‚**: `VIEWER` åŠä»¥ä¸Šæƒé™
- **å†…å®¹ç±»å‹**: `application/json`

---

## ğŸ“ è¯·æ±‚å‚æ•°

### Headers

```http
Authorization: Bearer {admin_token}
Content-Type: application/json
```

### Query Parameters

| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| `start_date` | `string` | å¦ | 7å¤©å‰ | ç»Ÿè®¡å¼€å§‹æ—¶é—´ (ISO 8601æ ¼å¼) |
| `end_date` | `string` | å¦ | å½“å‰æ—¶é—´ | ç»Ÿè®¡ç»“æŸæ—¶é—´ (ISO 8601æ ¼å¼) |

#### å‚æ•°è¯´æ˜
- **æ—¶é—´æ ¼å¼**: ISO 8601 æ ¼å¼ï¼Œå¦‚ `2025-10-18T00:00:00Z`
- **æ—¶é—´èŒƒå›´é™åˆ¶**: æœ€å¤§æŸ¥è¯¢èŒƒå›´ä¸è¶…è¿‡365å¤©
- **æ—¶åŒºå¤„ç†**: è‡ªåŠ¨è½¬æ¢ä¸ºUTCæ—¶é—´è¿›è¡Œç»Ÿè®¡
- **é»˜è®¤è¡Œä¸º**: å¦‚æœä¸æä¾›å‚æ•°ï¼Œé»˜è®¤ç»Ÿè®¡æœ€è¿‘7å¤©çš„æ•°æ®

---

## ğŸ“‹ è¿”å›æ•°æ®æ ¼å¼

### æˆåŠŸå“åº”

```json
{
  "period": {
    "start_date": "2025-10-18T00:00:00Z",
    "end_date": "2025-10-21T00:00:00Z"
  },
  "users": {
    "total": 23,
    "new_users": 1,
    "active_users": 1,
    "avg_daily_training": 2.33
  }
}
```

### æ•°æ®å­—æ®µè¯´æ˜

#### `period` (æ—¶é—´æ®µä¿¡æ¯)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `start_date` | `string` | ç»Ÿè®¡å¼€å§‹æ—¶é—´ (UTC) |
| `end_date` | `string` | ç»Ÿè®¡ç»“æŸæ—¶é—´ (UTC) |

#### `users` (ç”¨æˆ·ç»Ÿè®¡)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `total` | `int` | **æ³¨å†Œç”¨æˆ·æ•°é‡** - ç³»ç»Ÿä¸­æ‰€æœ‰æ³¨å†Œç”¨æˆ·çš„æ€»æ•° |
| `new_users` | `int` | **æ–°å¢ç”¨æˆ·æ•°é‡** - æŒ‡å®šæ—¶é—´èŒƒå›´å†…æ–°æ³¨å†Œçš„ç”¨æˆ·æ•° |
| `active_users` | `int` | **æ´»è·ƒç”¨æˆ·æ•°é‡** - æŒ‡å®šæ—¶é—´èŒƒå›´å†…æœ‰è®­ç»ƒè®°å½•çš„ç”¨æˆ·æ•° |
| `avg_daily_training` | `float` | **å¹³å‡æ¯æ—¥è®­ç»ƒæ¬¡æ•°** - åŸºäºè¯„ä¼°è®°å½•è®¡ç®—çš„æ—¥å‡è®­ç»ƒé‡ |

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### 1. è·å–é»˜è®¤ç»Ÿè®¡ï¼ˆæœ€è¿‘7å¤©ï¼‰

```bash
curl -X GET "http://localhost:8001/api/v1/admin/dashboard/stats" \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

### 2. è·å–è‡ªå®šä¹‰æ—¶é—´èŒƒå›´ç»Ÿè®¡

```bash
curl -X GET "http://localhost:8001/api/v1/admin/dashboard/stats?start_date=2025-10-15T00:00:00Z&end_date=2025-10-21T23:59:59Z" \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

### 3. JavaScript å‰ç«¯è°ƒç”¨

```javascript
// è·å–æ•°æ®æ¦‚è§ˆç»Ÿè®¡
async function getDashboardStats(startDate = null, endDate = null) {
  try {
    const token = localStorage.getItem('admin_token');
    let url = '/api/v1/admin/dashboard/stats';
    
    // æ„å»ºæŸ¥è¯¢å‚æ•°
    const params = new URLSearchParams();
    if (startDate) params.append('start_date', startDate);
    if (endDate) params.append('end_date', endDate);
    
    if (params.toString()) {
      url += '?' + params.toString();
    }
    
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();
    return data;
    
  } catch (error) {
    console.error('è·å–æ•°æ®æ¦‚è§ˆå¤±è´¥:', error);
    throw error;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
async function loadDashboard() {
  try {
    // è·å–æœ€è¿‘7å¤©æ•°æ®
    const stats = await getDashboardStats();
    
    // æ›´æ–°UI
    document.getElementById('total-users').textContent = stats.users.total;
    document.getElementById('new-users').textContent = stats.users.new_users;
    document.getElementById('active-users').textContent = stats.users.active_users;
    document.getElementById('avg-training').textContent = stats.users.avg_daily_training.toFixed(2);
    
    console.log('æ•°æ®æ¦‚è§ˆåŠ è½½æˆåŠŸ:', stats);
  } catch (error) {
    console.error('åŠ è½½æ•°æ®æ¦‚è§ˆå¤±è´¥:', error);
  }
}

// è·å–è‡ªå®šä¹‰æ—¶é—´èŒƒå›´æ•°æ®
async function loadCustomPeriodStats() {
  const startDate = '2025-10-15T00:00:00Z';
  const endDate = '2025-10-21T23:59:59Z';
  
  try {
    const stats = await getDashboardStats(startDate, endDate);
    console.log('è‡ªå®šä¹‰æ—¶é—´èŒƒå›´ç»Ÿè®¡:', stats);
  } catch (error) {
    console.error('è·å–è‡ªå®šä¹‰ç»Ÿè®¡å¤±è´¥:', error);
  }
}
```

---

## âŒ é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯ç 

| çŠ¶æ€ç  | é”™è¯¯è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|--------|----------|----------|
| `400` | è¯·æ±‚å‚æ•°é”™è¯¯ | æ£€æŸ¥æ—¶é—´æ ¼å¼å’ŒèŒƒå›´ |
| `401` | æœªè®¤è¯æˆ–tokenæ— æ•ˆ | é‡æ–°ç™»å½•è·å–æœ‰æ•ˆtoken |
| `403` | æƒé™ä¸è¶³ | ç¡®ä¿è´¦æˆ·æœ‰VIEWERåŠä»¥ä¸Šæƒé™ |
| `500` | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | è”ç³»ç³»ç»Ÿç®¡ç†å‘˜ |

### é”™è¯¯å“åº”æ ¼å¼

```json
{
  "detail": "å¼€å§‹æ—¶é—´ä¸èƒ½æ™šäºç»“æŸæ—¶é—´"
}
```

### å‚æ•°éªŒè¯é”™è¯¯ç¤ºä¾‹

```json
// æ—¶é—´èŒƒå›´è¿‡å¤§
{
  "detail": "æŸ¥è¯¢æ—¶é—´èŒƒå›´ä¸èƒ½è¶…è¿‡365å¤©"
}

// æ—¶é—´æ ¼å¼é”™è¯¯
{
  "detail": "Invalid date format"
}
```

---

## ğŸ”§ å‰ç«¯é›†æˆå»ºè®®

### 1. Vue.js ç»„ä»¶ç¤ºä¾‹

```vue
<template>
  <div class="dashboard-stats">
    <div class="stats-card">
      <h3>ç”¨æˆ·æ¦‚è§ˆ</h3>
      
      <div class="stats-grid">
        <div class="stat-item">
          <span class="label">æ³¨å†Œç”¨æˆ·æ€»æ•°</span>
          <span class="value">{{ stats.users?.total || 0 }}</span>
        </div>
        
        <div class="stat-item">
          <span class="label">æ–°å¢ç”¨æˆ·</span>
          <span class="value">{{ stats.users?.new_users || 0 }}</span>
        </div>
        
        <div class="stat-item">
          <span class="label">æ´»è·ƒç”¨æˆ·</span>
          <span class="value">{{ stats.users?.active_users || 0 }}</span>
        </div>
        
        <div class="stat-item">
          <span class="label">æ—¥å‡è®­ç»ƒæ¬¡æ•°</span>
          <span class="value">{{ formatTraining(stats.users?.avg_daily_training) }}</span>
        </div>
      </div>
      
      <div class="time-period">
        <small>ç»Ÿè®¡æ—¶é—´: {{ formatPeriod() }}</small>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  name: 'DashboardStats',
  data() {
    return {
      stats: {},
      loading: false,
      error: null
    }
  },
  
  async mounted() {
    await this.loadStats();
  },
  
  methods: {
    async loadStats() {
      this.loading = true;
      this.error = null;
      
      try {
        this.stats = await getDashboardStats();
      } catch (error) {
        this.error = 'åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥';
        console.error(error);
      } finally {
        this.loading = false;
      }
    },
    
    formatTraining(value) {
      return value ? value.toFixed(2) : '0.00';
    },
    
    formatPeriod() {
      if (!this.stats.period) return '';
      
      const start = new Date(this.stats.period.start_date).toLocaleDateString();
      const end = new Date(this.stats.period.end_date).toLocaleDateString();
      return `${start} - ${end}`;
    }
  }
}
</script>
```

### 2. React ç»„ä»¶ç¤ºä¾‹

```jsx
import React, { useState, useEffect } from 'react';

const DashboardStats = () => {
  const [stats, setStats] = useState({});
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    loadStats();
  }, []);
  
  const loadStats = async () => {
    setLoading(true);
    setError(null);
    
    try {
      const data = await getDashboardStats();
      setStats(data);
    } catch (err) {
      setError('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥');
      console.error(err);
    } finally {
      setLoading(false);
    }
  };
  
  const formatTraining = (value) => {
    return value ? value.toFixed(2) : '0.00';
  };
  
  if (loading) return <div>åŠ è½½ä¸­...</div>;
  if (error) return <div className="error">{error}</div>;
  
  return (
    <div className="dashboard-stats">
      <h3>ç”¨æˆ·æ¦‚è§ˆ</h3>
      
      <div className="stats-grid">
        <div className="stat-item">
          <span className="label">æ³¨å†Œç”¨æˆ·æ€»æ•°</span>
          <span className="value">{stats.users?.total || 0}</span>
        </div>
        
        <div className="stat-item">
          <span className="label">æ–°å¢ç”¨æˆ·</span>
          <span className="value">{stats.users?.new_users || 0}</span>
        </div>
        
        <div className="stat-item">
          <span className="label">æ´»è·ƒç”¨æˆ·</span>
          <span className="value">{stats.users?.active_users || 0}</span>
        </div>
        
        <div className="stat-item">
          <span className="label">æ—¥å‡è®­ç»ƒæ¬¡æ•°</span>
          <span className="value">{formatTraining(stats.users?.avg_daily_training)}</span>
        </div>
      </div>
    </div>
  );
};

export default DashboardStats;
```

---

## ğŸ“ˆ æ•°æ®è§£è¯»å»ºè®®

### æ ¸å¿ƒæŒ‡æ ‡å«ä¹‰

1. **æ³¨å†Œç”¨æˆ·æ€»æ•° (total)**
   - åæ˜ å¹³å°çš„ç”¨æˆ·è§„æ¨¡å’Œå½±å“åŠ›
   - æ˜¯è¡¡é‡å¹³å°å‘å±•çš„åŸºç¡€æŒ‡æ ‡

2. **æ–°å¢ç”¨æˆ·æ•°é‡ (new_users)**
   - åæ˜ å¹³å°çš„å¢é•¿é€Ÿåº¦å’Œå¸å¼•åŠ›
   - å¯ç”¨äºè¯„ä¼°è¥é”€æ´»åŠ¨æ•ˆæœ

3. **æ´»è·ƒç”¨æˆ·æ•°é‡ (active_users)**
   - åæ˜ ç”¨æˆ·çš„å‚ä¸åº¦å’Œå¹³å°ç²˜æ€§
   - æ˜¯è¡¡é‡å¹³å°å¥åº·åº¦çš„é‡è¦æŒ‡æ ‡

4. **å¹³å‡æ¯æ—¥è®­ç»ƒæ¬¡æ•° (avg_daily_training)**
   - åæ˜ ç”¨æˆ·çš„ä½¿ç”¨å¼ºåº¦å’Œå­¦ä¹ ç§¯ææ€§
   - å¯ç”¨äºè¯„ä¼°äº§å“åŠŸèƒ½çš„å¸å¼•åŠ›

### æ•°æ®åˆ†æå»ºè®®

- **ç”¨æˆ·æ´»è·ƒç‡** = æ´»è·ƒç”¨æˆ·æ•° / æ³¨å†Œç”¨æˆ·æ€»æ•° * 100%
- **ç”¨æˆ·å¢é•¿ç‡** = æ–°å¢ç”¨æˆ·æ•° / æŸ¥è¯¢å¤©æ•° (æ—¥å‡æ–°å¢)
- **è®­ç»ƒå¼ºåº¦åˆ†æ**: å…³æ³¨avg_daily_trainingçš„å˜åŒ–è¶‹åŠ¿

---

## ğŸ”„ ç‰ˆæœ¬æ›´æ–°è®°å½•

### v1.1.0 (2025-10-21)
- âœ… ç®€åŒ–æ•°æ®æ¨¡å‹ï¼Œä¸“æ³¨ç”¨æˆ·æ ¸å¿ƒæŒ‡æ ‡
- âœ… åˆ é™¤recordingsã€contentã€metricsç­‰å†—ä½™å­—æ®µ
- âœ… ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
- âœ… å¢å¼ºå‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†
- âœ… æ·»åŠ è¯¦ç»†çš„å‰ç«¯é›†æˆç¤ºä¾‹

### v1.0.0 (åˆå§‹ç‰ˆæœ¬)
- åŒ…å«å®Œæ•´çš„ç³»ç»Ÿç»Ÿè®¡æ•°æ®
- æ”¯æŒå¤šç»´åº¦æ•°æ®åˆ†æ

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦æŠ€æœ¯æ”¯æŒï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æŸ¥çœ‹ç›¸å…³æŠ€æœ¯æ–‡æ¡£ã€‚

**ç›¸å…³æ–‡æ¡£**:
- [ç®¡ç†å‘˜è®¤è¯APIæ–‡æ¡£](./ç®¡ç†å‘˜å®¡æ‰¹åŠŸèƒ½APIæ–‡æ¡£.md)
- [éŸ³é¢‘APIä½¿ç”¨æŒ‡å—](./AUDIO_API_FRONTEND_GUIDE.md)
- [ç”¨æˆ·æ³¨å†ŒAPIæ–‡æ¡£](./ç”¨æˆ·æ³¨å†ŒAPIæ–‡æ¡£.md)
