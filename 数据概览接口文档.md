# 📊 数据概览接口文档

## 接口概述

数据概览接口提供系统核心用户统计数据，专注于用户相关的关键指标，帮助管理员快速了解平台的用户活跃情况和使用状况。

---

## 🔗 接口信息

- **接口地址**: `GET /api/v1/admin/dashboard/stats`
- **权限要求**: `VIEWER` 及以上权限
- **内容类型**: `application/json`

---

## 📝 请求参数

### Headers

```http
Authorization: Bearer {admin_token}
Content-Type: application/json
```

### Query Parameters

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| `start_date` | `string` | 否 | 7天前 | 统计开始时间 (ISO 8601格式) |
| `end_date` | `string` | 否 | 当前时间 | 统计结束时间 (ISO 8601格式) |

#### 参数说明
- **时间格式**: ISO 8601 格式，如 `2025-10-18T00:00:00Z`
- **时间范围限制**: 最大查询范围不超过365天
- **时区处理**: 自动转换为UTC时间进行统计
- **默认行为**: 如果不提供参数，默认统计最近7天的数据

---

## 📋 返回数据格式

### 成功响应

```json
{
  "period": {
    "start_date": "2025-10-18T00:00:00Z",
    "end_date": "2025-10-21T00:00:00Z"
  },
  "users": {
    "total": 23,
    "new_users": 1,
    "active_users": 1,
    "avg_daily_training": 2.33
  }
}
```

### 数据字段说明

#### `period` (时间段信息)
| 字段 | 类型 | 说明 |
|------|------|------|
| `start_date` | `string` | 统计开始时间 (UTC) |
| `end_date` | `string` | 统计结束时间 (UTC) |

#### `users` (用户统计)
| 字段 | 类型 | 说明 |
|------|------|------|
| `total` | `int` | **注册用户数量** - 系统中所有注册用户的总数 |
| `new_users` | `int` | **新增用户数量** - 指定时间范围内新注册的用户数 |
| `active_users` | `int` | **活跃用户数量** - 指定时间范围内有训练记录的用户数 |
| `avg_daily_training` | `float` | **平均每日训练次数** - 基于评估记录计算的日均训练量 |

---

## 🚀 使用示例

### 1. 获取默认统计（最近7天）

```bash
curl -X GET "http://localhost:8001/api/v1/admin/dashboard/stats" \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

### 2. 获取自定义时间范围统计

```bash
curl -X GET "http://localhost:8001/api/v1/admin/dashboard/stats?start_date=2025-10-15T00:00:00Z&end_date=2025-10-21T23:59:59Z" \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

### 3. JavaScript 前端调用

```javascript
// 获取数据概览统计
async function getDashboardStats(startDate = null, endDate = null) {
  try {
    const token = localStorage.getItem('admin_token');
    let url = '/api/v1/admin/dashboard/stats';
    
    // 构建查询参数
    const params = new URLSearchParams();
    if (startDate) params.append('start_date', startDate);
    if (endDate) params.append('end_date', endDate);
    
    if (params.toString()) {
      url += '?' + params.toString();
    }
    
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();
    return data;
    
  } catch (error) {
    console.error('获取数据概览失败:', error);
    throw error;
  }
}

// 使用示例
async function loadDashboard() {
  try {
    // 获取最近7天数据
    const stats = await getDashboardStats();
    
    // 更新UI
    document.getElementById('total-users').textContent = stats.users.total;
    document.getElementById('new-users').textContent = stats.users.new_users;
    document.getElementById('active-users').textContent = stats.users.active_users;
    document.getElementById('avg-training').textContent = stats.users.avg_daily_training.toFixed(2);
    
    console.log('数据概览加载成功:', stats);
  } catch (error) {
    console.error('加载数据概览失败:', error);
  }
}

// 获取自定义时间范围数据
async function loadCustomPeriodStats() {
  const startDate = '2025-10-15T00:00:00Z';
  const endDate = '2025-10-21T23:59:59Z';
  
  try {
    const stats = await getDashboardStats(startDate, endDate);
    console.log('自定义时间范围统计:', stats);
  } catch (error) {
    console.error('获取自定义统计失败:', error);
  }
}
```

---

## ❌ 错误处理

### 常见错误码

| 状态码 | 错误说明 | 解决方案 |
|--------|----------|----------|
| `400` | 请求参数错误 | 检查时间格式和范围 |
| `401` | 未认证或token无效 | 重新登录获取有效token |
| `403` | 权限不足 | 确保账户有VIEWER及以上权限 |
| `500` | 服务器内部错误 | 联系系统管理员 |

### 错误响应格式

```json
{
  "detail": "开始时间不能晚于结束时间"
}
```

### 参数验证错误示例

```json
// 时间范围过大
{
  "detail": "查询时间范围不能超过365天"
}

// 时间格式错误
{
  "detail": "Invalid date format"
}
```

---

## 🔧 前端集成建议

### 1. Vue.js 组件示例

```vue
<template>
  <div class="dashboard-stats">
    <div class="stats-card">
      <h3>用户概览</h3>
      
      <div class="stats-grid">
        <div class="stat-item">
          <span class="label">注册用户总数</span>
          <span class="value">{{ stats.users?.total || 0 }}</span>
        </div>
        
        <div class="stat-item">
          <span class="label">新增用户</span>
          <span class="value">{{ stats.users?.new_users || 0 }}</span>
        </div>
        
        <div class="stat-item">
          <span class="label">活跃用户</span>
          <span class="value">{{ stats.users?.active_users || 0 }}</span>
        </div>
        
        <div class="stat-item">
          <span class="label">日均训练次数</span>
          <span class="value">{{ formatTraining(stats.users?.avg_daily_training) }}</span>
        </div>
      </div>
      
      <div class="time-period">
        <small>统计时间: {{ formatPeriod() }}</small>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  name: 'DashboardStats',
  data() {
    return {
      stats: {},
      loading: false,
      error: null
    }
  },
  
  async mounted() {
    await this.loadStats();
  },
  
  methods: {
    async loadStats() {
      this.loading = true;
      this.error = null;
      
      try {
        this.stats = await getDashboardStats();
      } catch (error) {
        this.error = '加载统计数据失败';
        console.error(error);
      } finally {
        this.loading = false;
      }
    },
    
    formatTraining(value) {
      return value ? value.toFixed(2) : '0.00';
    },
    
    formatPeriod() {
      if (!this.stats.period) return '';
      
      const start = new Date(this.stats.period.start_date).toLocaleDateString();
      const end = new Date(this.stats.period.end_date).toLocaleDateString();
      return `${start} - ${end}`;
    }
  }
}
</script>
```

### 2. React 组件示例

```jsx
import React, { useState, useEffect } from 'react';

const DashboardStats = () => {
  const [stats, setStats] = useState({});
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    loadStats();
  }, []);
  
  const loadStats = async () => {
    setLoading(true);
    setError(null);
    
    try {
      const data = await getDashboardStats();
      setStats(data);
    } catch (err) {
      setError('加载统计数据失败');
      console.error(err);
    } finally {
      setLoading(false);
    }
  };
  
  const formatTraining = (value) => {
    return value ? value.toFixed(2) : '0.00';
  };
  
  if (loading) return <div>加载中...</div>;
  if (error) return <div className="error">{error}</div>;
  
  return (
    <div className="dashboard-stats">
      <h3>用户概览</h3>
      
      <div className="stats-grid">
        <div className="stat-item">
          <span className="label">注册用户总数</span>
          <span className="value">{stats.users?.total || 0}</span>
        </div>
        
        <div className="stat-item">
          <span className="label">新增用户</span>
          <span className="value">{stats.users?.new_users || 0}</span>
        </div>
        
        <div className="stat-item">
          <span className="label">活跃用户</span>
          <span className="value">{stats.users?.active_users || 0}</span>
        </div>
        
        <div className="stat-item">
          <span className="label">日均训练次数</span>
          <span className="value">{formatTraining(stats.users?.avg_daily_training)}</span>
        </div>
      </div>
    </div>
  );
};

export default DashboardStats;
```

---

## 📈 数据解读建议

### 核心指标含义

1. **注册用户总数 (total)**
   - 反映平台的用户规模和影响力
   - 是衡量平台发展的基础指标

2. **新增用户数量 (new_users)**
   - 反映平台的增长速度和吸引力
   - 可用于评估营销活动效果

3. **活跃用户数量 (active_users)**
   - 反映用户的参与度和平台粘性
   - 是衡量平台健康度的重要指标

4. **平均每日训练次数 (avg_daily_training)**
   - 反映用户的使用强度和学习积极性
   - 可用于评估产品功能的吸引力

### 数据分析建议

- **用户活跃率** = 活跃用户数 / 注册用户总数 * 100%
- **用户增长率** = 新增用户数 / 查询天数 (日均新增)
- **训练强度分析**: 关注avg_daily_training的变化趋势

---

## 🔄 版本更新记录

### v1.1.0 (2025-10-21)
- ✅ 简化数据模型，专注用户核心指标
- ✅ 删除recordings、content、metrics等冗余字段
- ✅ 优化数据库查询性能
- ✅ 增强参数验证和错误处理
- ✅ 添加详细的前端集成示例

### v1.0.0 (初始版本)
- 包含完整的系统统计数据
- 支持多维度数据分析

---

## 📞 技术支持

如有任何问题或需要技术支持，请联系开发团队或查看相关技术文档。

**相关文档**:
- [管理员认证API文档](./管理员审批功能API文档.md)
- [音频API使用指南](./AUDIO_API_FRONTEND_GUIDE.md)
- [用户注册API文档](./用户注册API文档.md)
